name: use-sprkl

# The build section defines how to build the images of your development environment
# More info: https://www.okteto.com/docs/reference/manifest/#build
# build:

#   # You can use the following env vars to refer to this image in your deploy commands:
#   #  - OKTETO_BUILD_CATALOG_REGISTRY: image registry
#   #  - OKTETO_BUILD_CATALOG_REPOSITORY: image repo
#   #  - OKTETO_BUILD_CATALOG_IMAGE: image name
#   #  - OKTETO_BUILD_CATALOG_SHA: image tag sha256
#   use-sprkl-catalog:latest:
#     context: catalog
#     dockerfile: Dockerfile
#     image: catalog

#   # You can use the following env vars to refer to this image in your deploy commands:
#   #  - OKTETO_BUILD_METRICS_REGISTRY: image registry
#   #  - OKTETO_BUILD_METRICS_REPOSITORY: image repo
#   #  - OKTETO_BUILD_METRICS_IMAGE: image name
#   #  - OKTETO_BUILD_METRICS_SHA: image tag sha256
#   metrics:
#     context: metrics
#     dockerfile: Dockerfile
#     image: metrics

#   # You can use the following env vars to refer to this image in your deploy commands:
#   #  - OKTETO_BUILD_ORDERS_REGISTRY: image registry
#   #  - OKTETO_BUILD_ORDERS_REPOSITORY: image repo
#   #  - OKTETO_BUILD_ORDERS_IMAGE: image name
#   #  - OKTETO_BUILD_ORDERS_SHA: image tag sha256
#   orders:
#     context: orders
#     dockerfile: Dockerfile
#     image: orders

#   # You can use the following env vars to refer to this image in your deploy commands:
#   #  - OKTETO_BUILD_PAYMENTS_REGISTRY: image registry
#   #  - OKTETO_BUILD_PAYMENTS_REPOSITORY: image repo
#   #  - OKTETO_BUILD_PAYMENTS_IMAGE: image name
#   #  - OKTETO_BUILD_PAYMENTS_SHA: image tag sha256
#   payments:
#     context: payments
#     dockerfile: Dockerfile
#     image: payments

#   # You can use the following env vars to refer to this image in your deploy commands:
#   #  - OKTETO_BUILD_SHOP_REGISTRY: image registry
#   #  - OKTETO_BUILD_SHOP_REPOSITORY: image repo
#   #  - OKTETO_BUILD_SHOP_IMAGE: image name
#   #  - OKTETO_BUILD_SHOP_SHA: image tag sha256
#   shop:
#     context: shop
#     dockerfile: Dockerfile
#     image: shop

# The deploy section defines how to deploy your development environment
# More info: https://www.okteto.com/docs/reference/manifest/#deploy
deploy:
  - yarn docker:build
  - helm upgrade --install use-sprkl ./helm/use-sprkl --set catalog.image=${OKTETO_BUILD_CATALOG_IMAGE} --set metrics.image=${OKTETO_BUILD_METRICS_IMAGE} --set orders.image=${OKTETO_BUILD_ORDERS_IMAGE} --set payments.image=${OKTETO_BUILD_PAYMENTS_IMAGE} --set shop.image=${OKTETO_BUILD_SHOP_IMAGE}

# The dependencies section defines other git repositories to be deployed as part of your development environment
# More info: https://www.okteto.com/docs/reference/manifest/#dependencies
# dependencies:
#   - https://github.com/okteto/sample
# The dev section defines how to activate a development container
# More info: https://www.okteto.com/docs/reference/manifest/#dev
dev:
  shop:
    image: okteto/node:18
    command: /bin/bash
    sync:
      - shop:/code
    forward:
      - 5001:5000

  metrics:
    image: okteto/node:18
    command: /bin/bash
    sync:
      - metrics:/code

  orders:
    image: okteto/node:18
    command: /bin/bash
    sync:
      - orders:/code
    forward:
      - 3001:3000

