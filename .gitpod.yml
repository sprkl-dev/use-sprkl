# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.
vscode:
  extensions:
    - https://gitpod-vsix.s3.amazonaws.com/vscode.vsix

ports:
  - name: Store
    description: Sprkl store
    port: 80

  - name: Sprkl
    description: Sprkl agent
    port: 57011
tasks:
  - before: |
      gp env -e "PATH=$PATH;$HOME/.sprkl/bin"
      if [ -d /workspace/sprkl ]; then
        cp -rf /workspace/sprkl $HOME/.sprkl
      else
        yarn install
        docker compose up -d --build
        npx --yes @sprkl/scripts@0.0.38 install || true
        sprkl apply
        cp -rf $HOME/.sprkl /workspace/sprkl
      fi
    init: |
      if [ ! -d /workspace/sprkl ]; then 
        yarn install
        docker compose up -d --build
        npx --yes @sprkl/scripts@0.0.38 install || true
        gp env -e "PATH=$PATH;$HOME/.sprkl/bin"
        ln -sf $HOME/.sprkl/bin/sprkl ~/.local/bin/sprkl
        cp -rf $HOME/.sprkl /workspace/sprkl
        sprkl apply      
      fi
    command: |
      gp env -e "PATH=$PATH;$HOME/.sprkl/bin"
      if [ -d /workspace/sprkl ]; then
        cp -rf /workspace/sprkl $HOME/.sprkl
      else
        yarn install
        docker compose up -d --build
        npx --yes @sprkl/scripts@0.0.38 install || true
        sprkl apply
        cp -rf $HOME/.sprkl /workspace/sprkl
      fi

